<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MerdiVersa — Musique</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0c0f1f;
  --card:rgba(255,255,255,0.05);
  --accent1:#6b8eff;
  --accent2:#ff6b6b;
  --text:#eaf0ff;
  --muted:rgba(255,255,255,0.65);
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif;}
body{background:var(--bg);color:var(--text);display:flex;flex-direction:column;min-height:100vh;padding:24px;}
header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:#111;border-radius:12px;margin-bottom:24px;}
header h1{margin:0;font-size:22px;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
header nav{display:flex;gap:12px;}
header .btn{padding:8px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:var(--muted);font-weight:600;cursor:pointer;}
header .btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;color:white;}

.main{flex:1;display:flex;flex-direction:column;align-items:center;gap:16px;}
.search-bar{display:flex;gap:8px;width:100%;max-width:500px;margin-bottom:16px;}
.search-bar input{flex:1;padding:12px 16px;border-radius:12px;border:1px solid #333;background:#111;color:var(--text);font-size:15px;}
.search-bar button{padding:12px 20px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;font-weight:600;cursor:pointer;}

.music-card{background:var(--card);padding:16px;border-radius:16px;display:flex;flex-direction:column;align-items:center;gap:12px;width:100%;max-width:500px;box-shadow:0 4px 20px rgba(0,0,0,0.5);}
.music-card img{width:100%;border-radius:12px;}
.music-card h2{margin:0;font-size:18px;text-align:center;}
.music-card p{margin:4px 0;font-size:14px;color:var(--muted);}
.audio-controls{display:flex;gap:10px;align-items:center;margin-top:8px;width:100%;justify-content:center;flex-wrap:wrap;}
.audio-controls button{padding:6px 12px;border:none;border-radius:8px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;font-weight:600;cursor:pointer;}
.audio-controls input[type="range"]{width:100px;}
.download-btn{margin-top:8px;padding:10px 18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;font-weight:600;cursor:pointer;}

footer{text-align:center;padding:12px;color:var(--muted);font-size:13px;margin-top:24px;}
</style>
</head>
<body>

<header>
  <h1>MerdiVersa</h1>
  <nav>
    <button class="btn" onclick="location.href='merdiversa.html'">Accueil</button>
    <button class="btn" onclick="location.href='chat.html'">Chat IA</button>
    <button class="btn primary" onclick="location.href='image.html'">Images</button>
  </nav>
</header>

<div class="main">
  <div class="search-bar">
    <input type="text" id="song-query" placeholder="Recherchez une chanson...">
    <button id="search-btn">Rechercher</button>
  </div>

  <div id="music-container"></div>
</div>

<footer>© 2025 MerdiVersa — Créé par Merdi Madimba</footer>

<script>
const searchBtn = document.getElementById('search-btn');
const queryInput = document.getElementById('song-query');
const musicContainer = document.getElementById('music-container');

async function searchMusic(){
  const query = queryInput.value.trim();
  if(!query) return;
  musicContainer.innerHTML = "<p style='text-align:center;color:var(--muted)'>Recherche en cours...</p>";

  try{
    const res = await fetch(`https://shizuapi.onrender.com/api/youtubeplay?query=${encodeURIComponent(query)}`);
    const data = await res.json();

    if(!data.status || !data.data) {
      musicContainer.innerHTML = "<p style='text-align:center;color:var(--muted)'>Aucun résultat trouvé.</p>";
      return;
    }

    const song = data.data; // On prend le résultat
    musicContainer.innerHTML = `
      <div class="music-card">
        <img src="${song.thumbnail}" alt="${song.title}">
        <h2>${song.title}</h2>
        <p>Auteur : ${song.video.author}</p>
        <p>Durée : ${song.video.timestamp}</p>
        <audio id="audio-player" src="${song.audio}" preload="metadata"></audio>
        <div class="audio-controls">
          <button id="play-pause">▶️</button>
          <button id="rewind">⏪ 5s</button>
          <button id="forward">5s ⏩</button>
          <label>Vitesse:
            <select id="speed">
              <option value="0.5">0.5x</option>
              <option value="0.75">0.75x</option>
              <option value="1" selected>1x</option>
              <option value="1.25">1.25x</option>
              <option value="1.5">1.5x</option>
              <option value="2">2x</option>
            </select>
          </label>
          <label>Volume:
            <input type="range" id="volume" min="0" max="1" step="0.05" value="1">
          </label>
        </div>
        <button class="download-btn" id="download-btn">Télécharger</button>
      </div>
    `;

    const audio = document.getElementById('audio-player');
    const playBtn = document.getElementById('play-pause');
    const rewindBtn = document.getElementById('rewind');
    const forwardBtn = document.getElementById('forward');
    const speedSelect = document.getElementById('speed');
    const volumeSlider = document.getElementById('volume');
    const downloadBtn = document.getElementById('download-btn');

    playBtn.addEventListener('click', ()=>{
      if(audio.paused){ audio.play(); playBtn.textContent="⏸️"; }
      else { audio.pause(); playBtn.textContent="▶️"; }
    });
    rewindBtn.addEventListener('click', ()=>{ audio.currentTime = Math.max(0, audio.currentTime - 5); });
    forwardBtn.addEventListener('click', ()=>{ audio.currentTime = Math.min(audio.duration, audio.currentTime + 5); });
    speedSelect.addEventListener('change', ()=>{ audio.playbackRate = parseFloat(speedSelect.value); });
    volumeSlider.addEventListener('input', ()=>{ audio.volume = parseFloat(volumeSlider.value); });
    downloadBtn.addEventListener('click', ()=>{
      const a = document.createElement('a');
      a.href = song.audio;
      a.download = song.title.replace(/\s+/g,'_')+".mp3";
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

  } catch(err){
    console.error(err);
    musicContainer.innerHTML = "<p style='text-align:center;color:var(--muted)'>Erreur lors de la recherche. Réessayez.</p>";
  }
}

searchBtn.addEventListener('click', searchMusic);
queryInput.addEventListener('keydown', (e)=>{
  if(e.key==='Enter') searchBtn.click();
});
</script>

</body>
</html>
